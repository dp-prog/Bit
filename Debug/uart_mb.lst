STMicroelectronics list file postprocessor v1.01   (C)2009-2022   Tue Feb 08 00:03:06 2022
Page 1  Assembler
                                               c:\project\stm8\bit_asm\uart_mb.asm

   1                         stm8/     
   0  000000                                 #include "STM8L101.inc"
   1                         ; STM8L101.inc
   2                         ; Copyright (c) 2003-2017 STMicroelectronics
   3                         
   4  000000 U                               #ifdef   __STM8L101__
   7  000000                                 #define  __STM8L101__ 1
   8                         
   9                         ; STM8L101
  10                         
  11                         ; Port A
  12                         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                               ;;;;;;
  13  000000                                 EXTERN   PA_ODR.w      ; Port A data output latch 
                                                                ;register
  14  000000                                 EXTERN   PA_IDR.w      ; Port A input pin value 
                                                                ;register
  15  000000                                 EXTERN   PA_DDR.w      ; Port A data direction 
                                                                ;register
  16  000000                                 EXTERN   PA_CR1.w      ; Port A control register 1
  17  000000                                 EXTERN   PA_CR2.w      ; Port A control register 2
  18                         ; Port B
  19                         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                               ;;;;;;
  20  000000                                 EXTERN   PB_ODR.w      ; Port B data output latch 
                                                                ;register
  21  000000                                 EXTERN   PB_IDR.w      ; Port B input pin value 
                                                                ;register
  22  000000                                 EXTERN   PB_DDR.w      ; Port B data direction 
                                                                ;register
  23  000000                                 EXTERN   PB_CR1.w      ; Port B control register 1
  24  000000                                 EXTERN   PB_CR2.w      ; Port B control register 2
  25                         ; Port C
  26                         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                               ;;;;;;
  27  000000                                 EXTERN   PC_ODR.w      ; Port C data output latch 
                                                                ;register
  28  000000                                 EXTERN   PC_IDR.w      ; Port C input pin value 
                                                                ;register
  29  000000                                 EXTERN   PC_DDR.w      ; Port C data direction 
                                                                ;register
  30  000000                                 EXTERN   PC_CR1.w      ; Port C control register 1
  31  000000                                 EXTERN   PC_CR2.w      ; Port C control register 2
  32                         ; Port D
  33                         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                               ;;;;;;
  34  000000                                 EXTERN   PD_ODR.w      ; Port D data output latch 
                                                                ;register
  35  000000                                 EXTERN   PD_IDR.w      ; Port D input pin value 
                                                                ;register
  36  000000                                 EXTERN   PD_DDR.w      ; Port D data direction 
                                                                ;register
  37  000000                                 EXTERN   PD_CR1.w      ; Port D control register 1
  38  000000                                 EXTERN   PD_CR2.w      ; Port D control register 2
  39                         ; Flash
  40                         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                               ;;;;;;
STMicroelectronics list file postprocessor v1.01   (C)2009-2022   Tue Feb 08 00:03:06 2022
Page 2  Assembler
                                               c:\project\stm8\bit_asm\uart_mb.asm

  41  000000                                 EXTERN   FLASH_CR1.w   ; Flash control register 1
  42  000000                                 EXTERN   FLASH_CR2.w   ; Flash control register 2
  43  000000                                 EXTERN   FLASH_PUKR.w  ; Flash Program memory 
                                                                ;unprotection register
  44  000000                                 EXTERN   FLASH_DUKR.w  ; Data EEPROM unprotection 
                                                                ;register
  45  000000                                 EXTERN   FLASH_IAPSR.w  ; Flash in-application 
                                                                ;programming status register
  46                         ; External Interrupt Control Register (ITC)
  47                         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                               ;;;;;;
  48  000000                                 EXTERN   EXTI_CR1.w    ; External interrupt control 
                                                                ;register 1
  49  000000                                 EXTERN   EXTI_CR2.w    ; External interrupt control 
                                                                ;register 2
  50  000000                                 EXTERN   EXTI_CR3.w    ; External interrupt control 
                                                                ;register 3
  51  000000                                 EXTERN   EXTI_SR1.w    ; External interrupt status 
                                                                ;register 1
  52  000000                                 EXTERN   EXTI_SR2.w    ; External interrupt status 
                                                                ;register 2
  53  000000                                 EXTERN   EXTI_CONF.w   ; External interrupt port select
                                                                ; register
  54                         ; Wait For Event (WFE)
  55                         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                               ;;;;;;
  56  000000                                 EXTERN   WFE_CR1.w     ; WFE control register 1
  57  000000                                 EXTERN   WFE_CR2.w     ; WFE control register 2
  58                         ; Reset (RST)
  59                         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                               ;;;;;;
  60  000000                                 EXTERN   RST_CR.w      ; Reset control register
  61  000000                                 EXTERN   RST_SR.w      ; Reset status register
  62                         ; Clock Control (CLK)
  63                         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                               ;;;;;;
  64  000000                                 EXTERN   CLK_CKDIVR.w  ; Clock divider register
  65  000000                                 EXTERN   CLK_PCKENR.w  ; Peripheral clock gating 
                                                                ;register
  66  000000                                 EXTERN   CLK_CCOR.w    ; Configurable clock control 
                                                                ;register
  67                         ; Independent Watchdog (IWDG)
  68                         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                               ;;;;;;
  69  000000                                 EXTERN   IWDG_KR.w     ; IWDG Key Register
  70  000000                                 EXTERN   IWDG_PR.w     ; IWDG Prescaler Register
  71  000000                                 EXTERN   IWDG_RLR.w    ; IWDG Reload Register
  72                         ; Auto Wake-Up (AWU)
  73                         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                               ;;;;;;
  74  000000                                 EXTERN   AWU_CSR.w     ; AWU Control/Status Register
  75  000000                                 EXTERN   AWU_APR.w     ; AWU asynchronous prescaler 
                                                                ;buffer register
  76  000000                                 EXTERN   AWU_TBR.w     ; AWU Timebase selection 
                                                                ;register
  77                         ; Beeper (BEEP)
  78                         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
STMicroelectronics list file postprocessor v1.01   (C)2009-2022   Tue Feb 08 00:03:06 2022
Page 3  Assembler
                                               c:\project\stm8\bit_asm\uart_mb.asm

                               ;;;;;;
  79  000000                                 EXTERN   BEEP_CSR.w    ; BEEP Control/Status Register
  80                         ; Serial Peripheral Interface (SPI)
  81                         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                               ;;;;;;
  82  000000                                 EXTERN   SPI_CR1.w     ; SPI Control Register 1
  83  000000                                 EXTERN   SPI_CR2.w     ; SPI Control Register 2
  84  000000                                 EXTERN   SPI_ICR.w     ; SPI Interrupt Control 
                                                                ;Register
  85  000000                                 EXTERN   SPI_SR.w      ; SPI Status Register
  86  000000                                 EXTERN   SPI_DR.w      ; SPI Data Register
  87                         ; I2C Bus Interface (I2C)
  88                         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                               ;;;;;;
  89  000000                                 EXTERN   I2C_CR1.w     ; I2C control register 1
  90  000000                                 EXTERN   I2C_CR2.w     ; I2C control register 2
  91  000000                                 EXTERN   I2C_FREQR.w   ; I2C frequency register
  92  000000                                 EXTERN   I2C_OARL.w    ; I2C Own address register low
  93  000000                                 EXTERN   I2C_OARH.w    ; I2C Own address register high
  94  000000                                 EXTERN   I2C_DR.w      ; I2C data register
  95  000000                                 EXTERN   I2C_SR1.w     ; I2C status register 1
  96  000000                                 EXTERN   I2C_SR2.w     ; I2C status register 2
  97  000000                                 EXTERN   I2C_SR3.w     ; I2C status register 3
  98  000000                                 EXTERN   I2C_ITR.w     ; I2C interrupt control 
                                                                ;register
  99  000000                                 EXTERN   I2C_CCRL.w    ; I2C Clock control register 
                                                                ;low
 100  000000                                 EXTERN   I2C_CCRH.w    ; I2C Clock control register 
                                                                ;high
 101  000000                                 EXTERN   I2C_TRISER.w  ; I2C TRISE register
 102                         ; Universal synch/asynch receiver transmitter (USART)
 103                         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                               ;;;;;;
 104  000000                                 EXTERN   USART_SR.w    ; USART Status Register
 105  000000                                 EXTERN   USART_DR.w    ; USART Data Register
 106  000000                                 EXTERN   USART_BRR1.w  ; USART Baud Rate Register 1
 107  000000                                 EXTERN   USART_BRR2.w  ; USART Baud Rate Register 2
 108  000000                                 EXTERN   USART_CR1.w   ; USART Control Register 1
 109  000000                                 EXTERN   USART_CR2.w   ; USART Control Register 2
 110  000000                                 EXTERN   USART_CR3.w   ; USART Control Register 3
 111  000000                                 EXTERN   USART_CR4.w   ; USART Control Register 4
 112                         ; 16-Bit Timer 2 (TIM2)
 113                         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                               ;;;;;;
 114  000000                                 EXTERN   TIM2_CR1.w    ; TIM2 Control register 1
 115  000000                                 EXTERN   TIM2_CR2.w    ; TIM2 Control register 2
 116  000000                                 EXTERN   TIM2_SMCR.w   ; TIM2 Slave Mode Control 
                                                                ;register
 117  000000                                 EXTERN   TIM2_ETR.w    ; TIM2 External trigger 
                                                                ;register
 118  000000                                 EXTERN   TIM2_IER.w    ; TIM2 Interrupt enable 
                                                                ;register
 119  000000                                 EXTERN   TIM2_SR1.w    ; TIM2 Status register 1
 120  000000                                 EXTERN   TIM2_SR2.w    ; TIM2 Status register 2
 121  000000                                 EXTERN   TIM2_EGR.w    ; TIM2 Event Generation 
                                                                ;register
 122  000000                                 EXTERN   TIM2_CCMR1.w  ; TIM2 Capture/Compare mode 
STMicroelectronics list file postprocessor v1.01   (C)2009-2022   Tue Feb 08 00:03:06 2022
Page 4  Assembler
                                               c:\project\stm8\bit_asm\uart_mb.asm

                                                                ;register 1
 123  000000                                 EXTERN   TIM2_CCMR2.w  ; TIM2 Capture/Compare mode 
                                                                ;register 2
 124  000000                                 EXTERN   TIM2_CCER1.w  ; TIM2 Capture/Compare enable 
                                                                ;register 1
 125  000000                                 EXTERN   TIM2_CNTRH.w  ; Data bits High
 126  000000                                 EXTERN   TIM2_CNTRL.w  ; Data bits Low
 127  000000                                 EXTERN   TIM2_PSCR.w   ; TIM2 Prescaler register
 128  000000                                 EXTERN   TIM2_ARRH.w   ; Data bits High
 129  000000                                 EXTERN   TIM2_ARRL.w   ; Data bits Low
 130  000000                                 EXTERN   TIM2_CCR1H.w  ; Data bits High
 131  000000                                 EXTERN   TIM2_CCR1L.w  ; Data bits Low
 132  000000                                 EXTERN   TIM2_CCR2H.w  ; Data bits High
 133  000000                                 EXTERN   TIM2_CCR2L.w  ; Data bits Low
 134  000000                                 EXTERN   TIM2_BKR.w    ; TIM2 Break register
 135  000000                                 EXTERN   TIM2_OISR.w   ; TIM2 Output idle state 
                                                                ;register
 136                         ; 16-Bit Timer 3 (TIM3)
 137                         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                               ;;;;;;
 138  000000                                 EXTERN   TIM3_CR1.w    ; TIM3 Control register 1
 139  000000                                 EXTERN   TIM3_CR2.w    ; TIM3 Control register 2
 140  000000                                 EXTERN   TIM3_SMCR.w   ; TIM3 Slave Mode Control 
                                                                ;register
 141  000000                                 EXTERN   TIM3_ETR.w    ; TIM3 External trigger 
                                                                ;register
 142  000000                                 EXTERN   TIM3_IER.w    ; TIM3 Interrupt enable 
                                                                ;register
 143  000000                                 EXTERN   TIM3_SR1.w    ; TIM3 Status register 1
 144  000000                                 EXTERN   TIM3_SR2.w    ; TIM3 Status register 2
 145  000000                                 EXTERN   TIM3_EGR.w    ; TIM3 Event Generation 
                                                                ;register
 146  000000                                 EXTERN   TIM3_CCMR1.w  ; TIM3 Capture/Compare mode 
                                                                ;register 1
 147  000000                                 EXTERN   TIM3_CCMR2.w  ; TIM3 Capture/Compare mode 
                                                                ;register 2
 148  000000                                 EXTERN   TIM3_CCER1.w  ; TIM3 Capture/Compare enable 
                                                                ;register 1
 149  000000                                 EXTERN   TIM3_CNTRH.w  ; Data bits High
 150  000000                                 EXTERN   TIM3_CNTRL.w  ; Data bits Low
 151  000000                                 EXTERN   TIM3_PSCR.w   ; TIM3 Prescaler register
 152  000000                                 EXTERN   TIM3_ARRH.w   ; Data bits High
 153  000000                                 EXTERN   TIM3_ARRL.w   ; Data bits Low
 154  000000                                 EXTERN   TIM3_CCR1H.w  ; Data bits High
 155  000000                                 EXTERN   TIM3_CCR1L.w  ; Data bits Low
 156  000000                                 EXTERN   TIM3_CCR2H.w  ; Data bits High
 157  000000                                 EXTERN   TIM3_CCR2L.w  ; Data bits Low
 158  000000                                 EXTERN   TIM3_BKR.w    ; TIM3 Break register
 159  000000                                 EXTERN   TIM3_OISR.w   ; TIM3 Output idle state 
                                                                ;register
 160                         ; 8-Bit  Timer 4 (TIM4)
 161                         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                               ;;;;;;
 162  000000                                 EXTERN   TIM4_CR1.w    ; TIM4 Control register 1
 163  000000                                 EXTERN   TIM4_CR2.w    ; TIM4 Control register 2
 164  000000                                 EXTERN   TIM4_SMCR.w   ; TIM4 Slave Mode Control 
                                                                ;register
STMicroelectronics list file postprocessor v1.01   (C)2009-2022   Tue Feb 08 00:03:06 2022
Page 5  Assembler
                                               c:\project\stm8\bit_asm\uart_mb.asm

 165  000000                                 EXTERN   TIM4_IER.w    ; TIM4 Interrupt enable 
                                                                ;register
 166  000000                                 EXTERN   TIM4_SR1.w    ; TIM4 Status register 1
 167  000000                                 EXTERN   TIM4_EGR.w    ; TIM4 Event Generation 
                                                                ;register
 168  000000                                 EXTERN   TIM4_CNTR.w   ; TIM4 Counter
 169  000000                                 EXTERN   TIM4_PSCR.w   ; TIM4 Prescaler register
 170  000000                                 EXTERN   TIM4_ARR.w    ; TIM4 Auto-reload register
 171                         ; Infra Red Interface (IR)
 172                         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                               ;;;;;;
 173  000000                                 EXTERN   IR_CR.w       ; Infra-red control register
 174                         ; Comparators (CMP)
 175                         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                               ;;;;;;
 176  000000                                 EXTERN   COMP_CR.w     ; Comparator control register
 177  000000                                 EXTERN   COMP_CSR.w    ; Comparator status register
 178  000000                                 EXTERN   COMP_CCS.w    ; Comparator channel selection 
                                                                ;register
 179                         ;  Global configuration register (CFG)
 180                         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                               ;;;;;;
 181  000000                                 EXTERN   CFG_GCR.w     ; CFG Global configuration 
                                                                ;register
 182                         ; Interrupt Software Priority Register (ITC)
 183                         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                               ;;;;;;
 184  000000                                 EXTERN   ITC_SPR1.w    ; Interrupt Software priority 
                                                                ;register 1
 185  000000                                 EXTERN   ITC_SPR2.w    ; Interrupt Software priority 
                                                                ;register 2
 186  000000                                 EXTERN   ITC_SPR3.w    ; Interrupt Software priority 
                                                                ;register 3
 187  000000                                 EXTERN   ITC_SPR4.w    ; Interrupt Software priority 
                                                                ;register 4
 188  000000                                 EXTERN   ITC_SPR5.w    ; Interrupt Software priority 
                                                                ;register 5
 189  000000                                 EXTERN   ITC_SPR6.w    ; Interrupt Software priority 
                                                                ;register 6
 190  000000                                 EXTERN   ITC_SPR7.w    ; Interrupt Software priority 
                                                                ;register 7
 191  000000                                 EXTERN   ITC_SPR8.w    ; Interrupt Software priority 
                                                                ;register 8
 192  000000                                 #endif                 ; __STM8L101__
<END_OF_INCLUSION>
   3                         
   4  000002                       UartRX    equ      2
   5  000003                       UartTX    equ      3
   6  000004                       UartDE    equ      4
   7                         
   8                         ; Переменные в озу
   9  000000                                 extern   RegInput
  10  000000                                 extern   RegHolding
  11                         
  12  000000                                 extern   uartrx_cnt
  13  000000                                 extern   RxBuff
  14  000000                                 extern   RxBuff_addr
  15  000000                                 extern   RxBuff_comm
STMicroelectronics list file postprocessor v1.01   (C)2009-2022   Tue Feb 08 00:03:06 2022
Page 6  Assembler
                                               c:\project\stm8\bit_asm\uart_mb.asm

  16  000000                                 extern   RxBuff_a
  17  000000                                 extern   RxBuff_q
  18  000000                                 extern   RxBuff_n
  19                         
  20  000000                                 extern   uarttx_cnt
  21  000000                                 extern   TxBuff        
  22  000000                                 extern   TxBuff_addr
  23  000000                                 extern   TxBuff_comm
  24  000000                                 extern   TxBuff_a
  25  000000                                 extern   TxBuff_n
  26  000000                                 extern   TxBuff_d
  27  000000                                 extern   TxBuff_q
  28                                   
  29  000000                                 extern   uartrx_cnt_save
  30                         
  31  000000                                 extern   crc_hi                
  32  000000                                 extern   crc_lo
  33  000000                                 extern   crc_cnt
  34  000000                                 extern   crc_index     
  35                                   
  36  000000                                 extern   temp1_w
  37  000000                                 extern   temp2_w
  38  000000                                 extern   temp3_w
  39  000000                                 extern   temp4_w
  40  000000                                 extern   temp1_b
  41  000000                                 extern   temp2_b
  42  000000                                 extern   temp3_b
  43  000000                                 extern   temp4_b
  44                         
  45                         ; Переменные в eeprom
  46  000000                                 extern   CRC_Hi_table
  47  000000                                 extern   CRC_Lo_table
  48                                   
  49  000000                                 extern   mb_address
  50  000000                                 extern   adc_shift
  51  000000                                 extern   adc_koef
  52  000000                                 extern   adc_reg_init
  53                                   
  54                         ; Внешние функции	
  55  000000                                 extern   i2c_ads_read
  56                         
  57  000000                                 extern   unlock_PROG
  58  000000                                 extern   unlock_DATA
  59  000000                                 extern   lock_memory
  60                                   
  61  000000                                 extern   delay_10ms
  62                         
  63                                   segment  'rom'         
  64                         .uart_init:  
  65  008213   7215500C                      bres     PC_DDR, #UartRX  ; вход RX
  66  008217   7214500D                      bset     PC_CR1, #UartRX  ; подтяжка
  67  00821B   7216500C                      bset     PC_DDR, #UartTX  ; выход TX 
  68  00821F   7216500D                      bset     PC_CR1, #UartTX
  69  008223   7218500C                      bset     PC_DDR, #UartDE  ; выход DE
  70  008227   7218500D                      bset     PC_CR1, #UartDE
  71                         
  72  00822B   35685232                      mov      USART_BRR1,#$68  ; настройка UART
STMicroelectronics list file postprocessor v1.01   (C)2009-2022   Tue Feb 08 00:03:06 2022
Page 7  Assembler
                                               c:\project\stm8\bit_asm\uart_mb.asm

  73  00822F   35035233                      mov      USART_BRR2,#$03  
  74                         
  75  008233   72115234                      bres     USART_CR1,#0  ; CR1_PIEN прерывания на 
                                                                ;четность отключены
  76  008237   72155234                      bres     USART_CR1,#2  ; CR1_PCEN контроль четности 
                                                                ;отключен
  77  00823B   72195234                      bres     USART_CR1,#4  ; CR1_M 8-битный режим
  78  00823F   721B5234                      bres     USART_CR1,#5  ; CR1_UARTD 8-битный режим
  79                         
  80  008243   7219500A                      bres     PC_ODR, #UartDE  ; DE - на прием
  81  008247   72145235                      bset     USART_CR2, #2  ; Вкл прием
  82  00824B   72165235                      bset     USART_CR2, #3  ; Вкл передачу
  83  00824F   721A5235                      bset     USART_CR2, #5  ; Вкл прерывание
  84                                                          ;rim
  85  008253   81                            ret      
  86                         
  87                         .parse_modbus:  
  88                         parse_test_1  
  89  008254   A608                          ld       a,#$8         ; проверка - длина пакета 8 байт
                                                                ; ($01$03$00$01$00$01$D5$CA)
  90  008256   C00058                        sub      a,uartrx_cnt_save
  91  008259   2701                          jreq     parse_test_2  ; пакет слишком короткий или 
                                                                ;длинный
  92  00825B   81                            ret      
  93                                   
  94                         parse_test_2                     ; проверка 
  95  00825C   CE0008                        ldw      x,RegHolding
  96  00825F   72B00018                      subw     x,uartrx_cnt  ; включает в себя RxBuff_addr
  97                                                          ;jrne parse_modbus_end_ret	; 
                                                                ;адрес неверный
  98  008263   2701                          jreq     parse_CRC     ; адрес неверный
  99  008265   81                            ret      
 100                         parse_CRC  
 101  008266   CD83E5                        call     RX_CRC
 102  008269   90CE001F                      ldw      y,RxBuff_n
 103  00826D   72B20060                      subw     y,crc_hi
 104                         ;	jrne parse_modbus_end			; КС не корректная	
 105                         parse_test_3                     ; проверка номера команды
 106  008271   A604                          ld       a,#$4
 107  008273   C0001A                        sub      a,RxBuff_comm
 108  008276   2716                          jreq     parse_modbus_input_read
 109                         parse_test_4                     ; проверка номера команды	
 110  008278   A603                          ld       a,#$3
 111  00827A   C0001A                        sub      a,RxBuff_comm
 112  00827D   271E                          jreq     parse_modbus_holding_read
 113                         parse_test_5                     ; проверка номера команды	
 114  00827F   A606                          ld       a,#$6         
 115  008281   C0001A                        sub      a,RxBuff_comm
 116  008284   2726                          jreq     parse_modbus_holding_write
 117  008286   A601                          ld       a,#$1         ; 
 118  008288   C7003B                        ld       TxBuff_n,a
 119  00828B   CC82B7                        jp       parse_modbus_end  ; команда не поддерживается
 120                         
 121                         parse_modbus_input_read:         ; проверка диапазона (два 
                                                                ;регистра)
 122                         ;	ldw x,#$0001
 123                         ;	subw x,RxBuff_a
STMicroelectronics list file postprocessor v1.01   (C)2009-2022   Tue Feb 08 00:03:06 2022
Page 8  Assembler
                                               c:\project\stm8\bit_asm\uart_mb.asm

 124                         ;	jrmi parse_modbus_end			; начальный адрес за диапазоном
 125  00828E   CE001B                        ldw      x,RxBuff_a
 126  008291   72BB001D                      addw     x,RxBuff_q
 127  008295   1D0004                        subw     x,#$0004
 128  008298   2A1D                          jrpl     parse_modbus_end  ; выбраны регистры за 
                                                                ;диапазоном
 129  00829A   CC82D3                        jp       mb_input_read
 130                         
 131                         parse_modbus_holding_read:       ; проверка диапазона (четыре 
                                                                ;регистра)
 132                         ;	ldw x,#$0001
 133                         ;	subw x,RxBuff_a
 134                         ;	jrmi parse_modbus_end			; начальный адрес за диапазоном
 135  00829D   CE001B                        ldw      x,RxBuff_a
 136  0082A0   72BB001D                      addw     x,RxBuff_q
 137  0082A4   1D0005                        subw     x,#$0005
 138  0082A7   2A0E                          jrpl     parse_modbus_end  ; выбраны регистры за 
                                                                ;диапазоном
 139  0082A9   CC8317                        jp       mb_holding_read
 140                         
 141                         parse_modbus_holding_write:      ; проверка диапазона (четыре 
                                                                ;регистра)
 142                         ;	ldw x,#$0003
 143                         ;	subw x,RxBuff_a
 144                         ;	jrmi parse_modbus_end			; начальный адрес за диапазоном
 145  0082AC   CE001B                        ldw      x,RxBuff_a
 146                         ;	addw x,RxBuff_q
 147  0082AF   1D0004                        subw     x,#$0004
 148  0082B2   2A03                          jrpl     parse_modbus_end  ; выбраны регистры за 
                                                                ;диапазоном
 149  0082B4   CC835B                        jp       mb_holding_write
 150                         
 151                         parse_modbus_end:                ; формирую ответ на ошибочный 
                                                                ;запрос
 152  0082B7   A603                          ld       a,#$3
 153  0082B9   C70038                        ld       uarttx_cnt,a
 154  0082BC   5500190039                    mov      TxBuff_addr,RxBuff_addr
 155  0082C1   55001A003A                    mov      TxBuff_comm,RxBuff_comm
 156  0082C6   721E003A                      bset     TxBuff_comm,#$7  ; ответ содержит сообщение об 
                                                                ;ошибке
 157  0082CA   A603                          ld       a,#$3         ; Значение, содержащееся в поле 
                                                                ;данных запроса, является 
                                                                ;недопустимой величиной
 158  0082CC   C7003B                        ld       TxBuff_n,a    
 159  0082CF   CD842E                        call     TX_CRC        
 160                                   
 161                         parse_modbus_end_ret:  
 162  0082D2   81                            ret      
 163                         
 164                         .mb_input_read:  
 165  0082D3   5500190039                    mov      TxBuff_addr,RxBuff_addr
 166  0082D8   55001A003A                    mov      TxBuff_comm,RxBuff_comm  
 167  0082DD   CE001D                        ldw      x,RxBuff_q
 168  0082E0   A602                          ld       a,#2
 169  0082E2   42                            mul      X,a
 170  0082E3   9F                            ld       a,xl
 171  0082E4   C7003B                        ld       TxBuff_n,a    ; записал количество 
STMicroelectronics list file postprocessor v1.01   (C)2009-2022   Tue Feb 08 00:03:06 2022
Page 9  Assembler
                                               c:\project\stm8\bit_asm\uart_mb.asm

                                                                ;передаваемых байт из регистров
 172  0082E7   CE001B                        ldw      x,RxBuff_a
 173  0082EA   A602                          ld       a,#2
 174  0082EC   42                            mul      X,a
 175  0082ED   1C0000                        addw     x,#RegInput   ; смещение
 176  0082F0   9F                            ld       a,xl          ; 
 177  0082F1   CB003B                        add      a,TxBuff_n
 178  0082F4   C70080                        ld       temp1_b,a     
 179  0082F7   905F                          clrw     y
 180                         modbus_input_read_data_copy  
 181  0082F9   9F                            ld       a,xl
 182  0082FA   C10080                        cp       a,temp1_b                ; 
 183  0082FD   270D                          jreq     modbus_input_read_CRC
 184  0082FF   D60000                        ld       a,(RegInput,x)
 185  008302   90D7003C                      ld       (TxBuff_d,y),a  
 186  008306   905C                          incw     y
 187  008308   5C                            incw     x
 188  008309   CC82F9                        jp       modbus_input_read_data_copy  
 189                         modbus_input_read_CRC  
 190  00830C   909F                          ld       a,yl
 191  00830E   AB03                          add      a,#3
 192  008310   C70038                        ld       uarttx_cnt,a
 193  008313   CD842E                        call     TX_CRC
 194  008316   81                            ret      
 195                                   
 196                         .mb_holding_read:  
 197  008317   5500190039                    mov      TxBuff_addr,RxBuff_addr
 198  00831C   55001A003A                    mov      TxBuff_comm,RxBuff_comm  
 199  008321   CE001D                        ldw      x,RxBuff_q
 200  008324   A602                          ld       a,#2
 201  008326   42                            mul      X,a
 202  008327   9F                            ld       a,xl
 203  008328   C7003B                        ld       TxBuff_n,a    ; записал количество 
                                                                ;передаваемых байт из регистров
 204  00832B   CE001B                        ldw      x,RxBuff_a
 205  00832E   A602                          ld       a,#2
 206  008330   42                            mul      X,a
 207  008331   1C0008                        addw     x,#RegHolding  ; смещение
 208  008334   9F                            ld       a,xl          ; 
 209  008335   CB003B                        add      a,TxBuff_n
 210  008338   C70080                        ld       temp1_b,a     
 211  00833B   905F                          clrw     y
 212                         modbus_holding_read_data_copy  
 213  00833D   9F                            ld       a,xl
 214  00833E   C10080                        cp       a,temp1_b                ; 
 215  008341   270D                          jreq     modbus_holding_read_CRC
 216  008343   D60000                        ld       a,(RegInput,x)
 217  008346   90D7003C                      ld       (TxBuff_d,y),a  
 218  00834A   905C                          incw     y
 219  00834C   5C                            incw     x
 220  00834D   CC833D                        jp       modbus_holding_read_data_copy  
 221                         modbus_holding_read_CRC  
 222  008350   909F                          ld       a,yl
 223  008352   AB03                          add      a,#3
 224  008354   C70038                        ld       uarttx_cnt,a
 225  008357   CD842E                        call     TX_CRC
 226  00835A   81                            ret      
STMicroelectronics list file postprocessor v1.01   (C)2009-2022   Tue Feb 08 00:03:06 2022
Page 10  Assembler
                                               c:\project\stm8\bit_asm\uart_mb.asm

 227                         
 228                         
 229                         .mb_holding_write:               ; запись данных в еепром
 230  00835B   CD85A1                        call     unlock_PROG
 231                                                          ;lock_memory
 232  00835E   90CE001B                      ldw      y,RxBuff_a
 233  008362   905A                          decw     y
 234  008364   2B0F                          jrmi     modbus_holding_write_0
 235  008366   905A                          decw     y
 236  008368   2B1A                          jrmi     modbus_holding_write_1
 237  00836A   905A                          decw     y
 238  00836C   2B27                          jrmi     modbus_holding_write_2
 239  00836E   905A                          decw     y
 240  008370   2B34                          jrmi     modbus_holding_write_3
 241  008372   CC82B7                        jp       parse_modbus_end
 242                         modbus_holding_write_0:  
 243  008375   90CE001D                      ldw      y,RxBuff_q
 244  008379   90CF0008                      ldw      RegHolding,y
 245  00837D   90CF85F0                      ldw      mb_address,y
 246  008381   CC83B7                        jp       modbus_holding_write_OK
 247                         modbus_holding_write_1:  
 248  008384   90CE001D                      ldw      y,RxBuff_q
 249  008388   AE0002                        ldw      x,#2
 250  00838B   DF0008                        ldw      (RegHolding,x),y
 251  00838E   90CF85F2                      ldw      adc_shift,y
 252  008392   CC83B7                        jp       modbus_holding_write_OK
 253                         modbus_holding_write_2:  
 254  008395   90CE001D                      ldw      y,RxBuff_q
 255  008399   AE0004                        ldw      x,#4
 256  00839C   DF0008                        ldw      (RegHolding,x),y
 257  00839F   90CF85F4                      ldw      adc_koef,y
 258  0083A3   CC83B7                        jp       modbus_holding_write_OK
 259                         modbus_holding_write_3:  
 260  0083A6   90CE001D                      ldw      y,RxBuff_q
 261  0083AA   AE0006                        ldw      x,#6
 262  0083AD   DF0008                        ldw      (RegHolding,x),y
 263  0083B0   90CF85F6                      ldw      adc_reg_init,y
 264  0083B4   CC83B7                        jp       modbus_holding_write_OK
 265                         
 266                         modbus_holding_write_OK:  
 267  0083B7   5500190039                    mov      TxBuff_addr,RxBuff_addr
 268  0083BC   55001A003A                    mov      TxBuff_comm,RxBuff_comm
 269  0083C1   55001B003B                    mov      TxBuff_a,RxBuff_a
 270  0083C6   90CE001B                      ldw      y,RxBuff_a
 271  0083CA   90CF003B                      ldw      TxBuff_a,y
 272  0083CE   90CE001D                      ldw      y,RxBuff_q
 273  0083D2   90CF003D                      ldw      TxBuff_q,y
 274                         modbus_holding_write_CRC  
 275  0083D6   A606                          ld       a,#6
 276  0083D8   C70038                        ld       uarttx_cnt,a
 277  0083DB   CD842E                        call     TX_CRC
 278  0083DE   CD85CB                        call     delay_10ms
 279  0083E1   CD85B3                        call     lock_memory
 280  0083E4   81                            ret      
 281                                   
 282                         .RX_CRC:  
 283  0083E5   5500FF0061                    mov      crc_lo,$FF    ;первоначально загружаем 0xFF в 
STMicroelectronics list file postprocessor v1.01   (C)2009-2022   Tue Feb 08 00:03:06 2022
Page 11  Assembler
                                               c:\project\stm8\bit_asm\uart_mb.asm

                                                                ;оба регистра
 284  0083EA   5500FF0060                    mov      crc_hi,$FF
 285  0083EF   35000062                      mov      crc_cnt, #0   ; начинаю с 0-го байта
 286                                                          ; тест на 0 uartrx_cnt_save
 287  0083F3   725D0058                      tnz      uartrx_cnt_save
 288  0083F7   2734                          jreq     RX_CRC_cycle_end
 289  0083F9   725A0058                      dec      uartrx_cnt_save
 290  0083FD   725A0058                      dec      uartrx_cnt_save
 291                         RX_CRC_cycle  
 292  008401   AE0000                        ldw      x, #0         ; надо обнулить оба байта 
                                                                ;регистра
 293  008404   C60062                        ld       a, crc_cnt
 294  008407   97                            ld       xl, a
 295  008408   D60019                        ld       a,(RxBuff,x)  ; взял байт из сообщения
 296  00840B   C80060                        xor      a,crc_hi
 297  00840E   C70063                        ld       crc_index,a   ; получил индекс-смещения в 
                                                                ;таблицах
 298  008411   97                            ld       xl, a
 299  008412   D68600                        ld       a,(CRC_Hi_table,x)  ; взял байт из таблицы
 300  008415   C80061                        xor      a,crc_lo
 301  008418   C70060                        ld       crc_hi,a
 302  00841B   D68700                        ld       a,(CRC_Lo_table,x)  ; взял байт из таблицы
 303  00841E   C70061                        ld       crc_lo,a
 304  008421   725C0062                      inc      crc_cnt
 305  008425   C60058                        ld       a,uartrx_cnt_save  ; здесь буду тестировать на 
                                                                ;конец пакета
 306  008428   C10062                        cp       a,crc_cnt
 307  00842B   26D4                          jrne     RX_CRC_cycle
 308                         RX_CRC_cycle_end  
 309  00842D   81                            ret      
 310                                   
 311                         TX_CRC:   
 312  00842E   35FF0061                      mov      crc_lo,#$FF   ;первоначально загружаем 0xFF в 
                                                                ;оба регистра
 313  008432   35FF0060                      mov      crc_hi,#$FF
 314  008436   35000062                      mov      crc_cnt,#0    ; начинаю с 0-го байта
 315                         TX_CRC_cycle:  
 316  00843A   AE0000                        ldw      x,#0          ; надо обнулить оба байта 
                                                                ;регистра
 317  00843D   C60062                        ld       a,crc_cnt
 318  008440   97                            ld       xl,a
 319  008441   D60039                        ld       a,(TxBuff,x)  ; взял байт из сообщения
 320  008444   C80060                        xor      a,crc_hi
 321  008447   C70063                        ld       crc_index,a   ; получил индекс-смещения в 
                                                                ;таблицах
 322  00844A   97                            ld       xl,a
 323  00844B   D68600                        ld       a,(CRC_Hi_table,x)  ; взял байт из таблицы
 324  00844E   C80061                        xor      a,crc_lo
 325  008451   C70060                        ld       crc_hi,a
 326  008454   D68700                        ld       a,(CRC_Lo_table,x)  ; взял байт из таблицы
 327  008457   C70061                        ld       crc_lo,a
 328  00845A   725C0062                      inc      crc_cnt
 329  00845E   C60038                        ld       a,uarttx_cnt  ; здесь буду тестировать на 
                                                                ;конец пакета
 330  008461   C10062                        cp       a,crc_cnt
 331  008464   26D4                          jrne     TX_CRC_cycle
 332                         TX_CRC_cycle_end:  
STMicroelectronics list file postprocessor v1.01   (C)2009-2022   Tue Feb 08 00:03:06 2022
Page 12  Assembler
                                               c:\project\stm8\bit_asm\uart_mb.asm

 333  008466   C60062                        ld       a, crc_cnt
 334  008469   97                            ld       xl,a
 335  00846A   C60060                        ld       a,crc_hi
 336  00846D   D70039                        ld       (TxBuff,x),a
 337  008470   5C                            incw     x
 338  008471   C60061                        ld       a,crc_lo
 339  008474   D70039                        ld       (TxBuff,x),a  ; пакет сформирован
 340  008477   5C                            incw     x
 341  008478   CF0078                        ldw      temp1_w,x
 342  00847B   CD847F                        call     uart_mb_write
 343  00847E   81                            ret      
 344                         
 345                         .uart_mb_write:  
 346                                                          ;bres USART_CR2, #3				; Выкл 
                                                                ;передачу
 347  00847F   721B5235                      bres     USART_CR2, #5  ; прерывание выкл
 348  008483   7218500A                      bset     PC_ODR, #UartDE  ; DE - на прием
 349  008487   AE0000                        ldw      x, #0         ; надо обнулить оба байта 
                                                                ;регистра
 350                         next:     
 351  00848A   C30078                        cpw      x,temp1_w
 352  00848D   270F                          jreq     end_tx        
 353  00848F   D60039                        ld       a,(TxBuff,x)  ; взял байт из сообщения
 354                         wait_tx:  
 355  008492   720F5230FB                    btjf     USART_SR, #7, wait_tx  ; wait until TX buffer is empty
 356  008497   C75231                        ld       USART_DR, a   ; print out the character
 357                                                          ;bset USART_CR2, #3				; Вкл 
                                                                ;передачу
 358  00849A   5C                            incw     x             ; increment the character 
                                                                ;address
 359  00849B   CC848A                        jp       next          ; process next character
 360                         end_tx:   
 361  00849E   720D5230FB                    btjf     USART_SR, #6, end_tx  ; wait for the transmission to 
                                                                ;complete	
 362  0084A3   7219500A                      bres     PC_ODR, #UartDE  ; DE - на прием
 363                                                          ;bres USART_CR2, #3				; Выкл 
                                                                ;передачу
 364  0084A7   721A5235                      bset     USART_CR2, #5  ; Вкл прерывание прима
 365  0084AB   81                            ret      
 366                         
 367                         
 368  0084AC                                 end      
STMicroelectronics list file postprocessor v1.01   (C)2009-2022   Tue Feb 08 00:03:06 2022
Page 13  Assembler
                                               c:\project\stm8\bit_asm\uart_mb.asm

Symbol Name                       Value     Call       Type  Scope      Rel.  Line  Privacy  Segment   Size  Bytes File

AWU_CSR                               50F0         no  WORD  Internal   ABS     74  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
AWU_APR                               50F1         no  WORD  Internal   ABS     75  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
AWU_TBR                               50F2         no  WORD  Internal   ABS     76  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc

BEEP_CSR                              50F3         no  WORD  Internal   ABS     79  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc

CLK_CKDIVR                            50C0         no  WORD  Internal   ABS     64  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
CLK_PCKENR                            50C3         no  WORD  Internal   ABS     65  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
CLK_CCOR                              50C5         no  WORD  Internal   ABS     66  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
COMP_CR                               5300         no  WORD  Internal   ABS    176  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
COMP_CSR                              5301         no  WORD  Internal   ABS    177  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
COMP_CCS                              5302         no  WORD  Internal   ABS    178  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
CFG_GCR                               7F60         no  WORD  Internal   ABS    181  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
CRC_Hi_table                          8600         no  WORD  Internal   ABS     46  private  text         0     0  -
CRC_Lo_table                          8700         no  WORD  Internal   ABS     47  private  text         0     0  -

EXTI_CR1                              50A0         no  WORD  Internal   ABS     48  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
EXTI_CR2                              50A1         no  WORD  Internal   ABS     49  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
EXTI_CR3                              50A2         no  WORD  Internal   ABS     50  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
EXTI_SR1                              50A3         no  WORD  Internal   ABS     51  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
EXTI_SR2                              50A4         no  WORD  Internal   ABS     52  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
EXTI_CONF                             50A5         no  WORD  Internal   ABS     53  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc

FLASH_CR1                             5050         no  WORD  Internal   ABS     41  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
FLASH_CR2                             5051         no  WORD  Internal   ABS     42  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
FLASH_PUKR                            5052         no  WORD  Internal   ABS     43  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
FLASH_DUKR                            5053         no  WORD  Internal   ABS     44  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
FLASH_IAPSR                           5054         no  WORD  Internal   ABS     45  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc

IWDG_KR                               50E0         no  WORD  Internal   ABS     69  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
IWDG_PR                               50E1         no  WORD  Internal   ABS     70  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
IWDG_RLR                              50E2         no  WORD  Internal   ABS     71  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
I2C_CR1                               5210         no  WORD  Internal   ABS     89  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
I2C_CR2                               5211         no  WORD  Internal   ABS     90  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
I2C_FREQR                             5212         no  WORD  Internal   ABS     91  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
I2C_OARL                              5213         no  WORD  Internal   ABS     92  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
I2C_OARH                              5214         no  WORD  Internal   ABS     93  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
I2C_DR                                5216         no  WORD  Internal   ABS     94  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
I2C_SR1                               5217         no  WORD  Internal   ABS     95  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
I2C_SR2                               5218         no  WORD  Internal   ABS     96  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
I2C_SR3                               5219         no  WORD  Internal   ABS     97  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
I2C_ITR                               521A         no  WORD  Internal   ABS     98  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
I2C_CCRL                              521B         no  WORD  Internal   ABS     99  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
I2C_CCRH                              521C         no  WORD  Internal   ABS    100  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
I2C_TRISER                            521D         no  WORD  Internal   ABS    101  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
IR_CR                                 52FF         no  WORD  Internal   ABS    173  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
ITC_SPR1                              7F70         no  WORD  Internal   ABS    184  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
ITC_SPR2                              7F71         no  WORD  Internal   ABS    185  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
ITC_SPR3                              7F72         no  WORD  Internal   ABS    186  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
ITC_SPR4                              7F73         no  WORD  Internal   ABS    187  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
ITC_SPR5                              7F74         no  WORD  Internal   ABS    188  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
ITC_SPR6                              7F75         no  WORD  Internal   ABS    189  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
ITC_SPR7                              7F76         no  WORD  Internal   ABS    190  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
ITC_SPR8                              7F77         no  WORD  Internal   ABS    191  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc

STMicroelectronics list file postprocessor v1.01   (C)2009-2022   Tue Feb 08 00:03:06 2022
Page 14  Assembler
                                               c:\project\stm8\bit_asm\uart_mb.asm

PA_ODR                                5000         no  WORD  Internal   ABS     13  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
PA_IDR                                5001         no  WORD  Internal   ABS     14  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
PA_DDR                                5002         no  WORD  Internal   ABS     15  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
PA_CR1                                5003         no  WORD  Internal   ABS     16  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
PA_CR2                                5004         no  WORD  Internal   ABS     17  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
PB_ODR                                5005         no  WORD  Internal   ABS     20  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
PB_IDR                                5006         no  WORD  Internal   ABS     21  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
PB_DDR                                5007         no  WORD  Internal   ABS     22  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
PB_CR1                                5008         no  WORD  Internal   ABS     23  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
PB_CR2                                5009         no  WORD  Internal   ABS     24  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
PC_ODR                                500A         no  WORD  Internal   ABS     27  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
PC_IDR                                500B         no  WORD  Internal   ABS     28  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
PC_DDR                                500C         no  WORD  Internal   ABS     29  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
PC_CR1                                500D         no  WORD  Internal   ABS     30  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
PC_CR2                                500E         no  WORD  Internal   ABS     31  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
PD_ODR                                500F         no  WORD  Internal   ABS     34  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
PD_IDR                                5010         no  WORD  Internal   ABS     35  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
PD_DDR                                5011         no  WORD  Internal   ABS     36  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
PD_CR1                                5012         no  WORD  Internal   ABS     37  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
PD_CR2                                5013         no  WORD  Internal   ABS     38  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc

RST_CR                                50B0         no  WORD  Internal   ABS     60  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
RST_SR                                50B1         no  WORD  Internal   ABS     61  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
RegInput                              0000         no  WORD  Internal   ABS      9  private  text         0     0  -
RegHolding                            0008         no  WORD  Internal   ABS     10  private  text         0     0  -
RxBuff                                0019         no  WORD  Internal   ABS     13  private  text         0     0  -
RxBuff_addr                           0019         no  WORD  Internal   ABS     14  private  text         0     0  -
RxBuff_comm                           001A         no  WORD  Internal   ABS     15  private  text         0     0  -
RxBuff_a                              001B         no  WORD  Internal   ABS     16  private  text         0     0  -
RxBuff_q                              001D         no  WORD  Internal   ABS     17  private  text         0     0  -
RxBuff_n                              001F         no  WORD  Internal   ABS     18  private  text         0     0  -
RX_CRC                                83E5         no  WORD  Internal   ABS    282  public   text        28     0  -
RX_CRC_cycle                          8401         no  WORD  Internal   ABS    291  private  text        44     0  -
RX_CRC_cycle_end                      842D         no  WORD  Internal   ABS    308  private  text         1     0  -

SPI_CR1                               5200         no  WORD  Internal   ABS     82  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
SPI_CR2                               5201         no  WORD  Internal   ABS     83  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
SPI_ICR                               5202         no  WORD  Internal   ABS     84  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
SPI_SR                                5203         no  WORD  Internal   ABS     85  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
SPI_DR                                5204         no  WORD  Internal   ABS     86  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc

TIM2_CR1                              5250         no  WORD  Internal   ABS    114  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
TIM2_CR2                              5251         no  WORD  Internal   ABS    115  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
TIM2_SMCR                             5252         no  WORD  Internal   ABS    116  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
TIM2_ETR                              5253         no  WORD  Internal   ABS    117  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
TIM2_IER                              5254         no  WORD  Internal   ABS    118  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
TIM2_SR1                              5255         no  WORD  Internal   ABS    119  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
TIM2_SR2                              5256         no  WORD  Internal   ABS    120  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
TIM2_EGR                              5257         no  WORD  Internal   ABS    121  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
TIM2_CCMR1                            5258         no  WORD  Internal   ABS    122  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
TIM2_CCMR2                            5259         no  WORD  Internal   ABS    123  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
TIM2_CCER1                            525A         no  WORD  Internal   ABS    124  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
TIM2_CNTRH                            525B         no  WORD  Internal   ABS    125  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
TIM2_CNTRL                            525C         no  WORD  Internal   ABS    126  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
TIM2_PSCR                             525D         no  WORD  Internal   ABS    127  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
TIM2_ARRH                             525E         no  WORD  Internal   ABS    128  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
TIM2_ARRL                             525F         no  WORD  Internal   ABS    129  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
STMicroelectronics list file postprocessor v1.01   (C)2009-2022   Tue Feb 08 00:03:06 2022
Page 15  Assembler
                                               c:\project\stm8\bit_asm\uart_mb.asm

TIM2_CCR1H                            5260         no  WORD  Internal   ABS    130  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
TIM2_CCR1L                            5261         no  WORD  Internal   ABS    131  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
TIM2_CCR2H                            5262         no  WORD  Internal   ABS    132  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
TIM2_CCR2L                            5263         no  WORD  Internal   ABS    133  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
TIM2_BKR                              5264         no  WORD  Internal   ABS    134  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
TIM2_OISR                             5265         no  WORD  Internal   ABS    135  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
TIM3_CR1                              5280         no  WORD  Internal   ABS    138  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
TIM3_CR2                              5281         no  WORD  Internal   ABS    139  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
TIM3_SMCR                             5282         no  WORD  Internal   ABS    140  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
TIM3_ETR                              5283         no  WORD  Internal   ABS    141  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
TIM3_IER                              5284         no  WORD  Internal   ABS    142  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
TIM3_SR1                              5285         no  WORD  Internal   ABS    143  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
TIM3_SR2                              5286         no  WORD  Internal   ABS    144  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
TIM3_EGR                              5287         no  WORD  Internal   ABS    145  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
TIM3_CCMR1                            5288         no  WORD  Internal   ABS    146  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
TIM3_CCMR2                            5289         no  WORD  Internal   ABS    147  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
TIM3_CCER1                            528A         no  WORD  Internal   ABS    148  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
TIM3_CNTRH                            528B         no  WORD  Internal   ABS    149  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
TIM3_CNTRL                            528C         no  WORD  Internal   ABS    150  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
TIM3_PSCR                             528D         no  WORD  Internal   ABS    151  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
TIM3_ARRH                             528E         no  WORD  Internal   ABS    152  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
TIM3_ARRL                             528F         no  WORD  Internal   ABS    153  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
TIM3_CCR1H                            5290         no  WORD  Internal   ABS    154  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
TIM3_CCR1L                            5291         no  WORD  Internal   ABS    155  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
TIM3_CCR2H                            5292         no  WORD  Internal   ABS    156  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
TIM3_CCR2L                            5293         no  WORD  Internal   ABS    157  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
TIM3_BKR                              5294         no  WORD  Internal   ABS    158  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
TIM3_OISR                             5295         no  WORD  Internal   ABS    159  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
TIM4_CR1                              52E0         no  WORD  Internal   ABS    162  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
TIM4_CR2                              52E1         no  WORD  Internal   ABS    163  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
TIM4_SMCR                             52E2         no  WORD  Internal   ABS    164  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
TIM4_IER                              52E3         no  WORD  Internal   ABS    165  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
TIM4_SR1                              52E4         no  WORD  Internal   ABS    166  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
TIM4_EGR                              52E5         no  WORD  Internal   ABS    167  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
TIM4_CNTR                             52E6         no  WORD  Internal   ABS    168  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
TIM4_PSCR                             52E7         no  WORD  Internal   ABS    169  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
TIM4_ARR                              52E8         no  WORD  Internal   ABS    170  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
TxBuff                                0039         no  WORD  Internal   ABS     21  private  text         0     0  -
TxBuff_addr                           0039         no  WORD  Internal   ABS     22  private  text         0     0  -
TxBuff_comm                           003A         no  WORD  Internal   ABS     23  private  text         0     0  -
TxBuff_a                              003B         no  WORD  Internal   ABS     24  private  text         0     0  -
TxBuff_n                              003B         no  WORD  Internal   ABS     25  private  text         0     0  -
TxBuff_d                              003C         no  WORD  Internal   ABS     26  private  text         0     0  -
TxBuff_q                              003D         no  WORD  Internal   ABS     27  private  text         0     0  -
TX_CRC                                842E         no  WORD  Internal   ABS    311  private  text        12     0  -
TX_CRC_cycle                          843A         no  WORD  Internal   ABS    315  private  text        44     0  -
TX_CRC_cycle_end                      8466         no  WORD  Internal   ABS    332  private  text        25     0  -

USART_SR                              5230         no  WORD  Internal   ABS    104  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
USART_DR                              5231         no  WORD  Internal   ABS    105  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
USART_BRR1                            5232         no  WORD  Internal   ABS    106  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
USART_BRR2                            5233         no  WORD  Internal   ABS    107  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
USART_CR1                             5234         no  WORD  Internal   ABS    108  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
USART_CR2                             5235         no  WORD  Internal   ABS    109  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
USART_CR3                             5236         no  WORD  Internal   ABS    110  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
USART_CR4                             5237         no  WORD  Internal   ABS    111  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
UartRX                                0002         no  WORD  Internal   ABS      4  private  text         0     0  -
STMicroelectronics list file postprocessor v1.01   (C)2009-2022   Tue Feb 08 00:03:06 2022
Page 16  Assembler
                                               c:\project\stm8\bit_asm\uart_mb.asm

UartTX                                0003         no  WORD  Internal   ABS      5  private  text         0     0  -
UartDE                                0004         no  WORD  Internal   ABS      6  private  text         0     0  -

WFE_CR1                               50A6         no  WORD  Internal   ABS     56  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc
WFE_CR2                               50A7         no  WORD  Internal   ABS     57  private  text         0     0  c:\project\stm8\bit_asm\stm8l101.inc

adc_shift                             85F2         no  WORD  Internal   ABS     50  private  text         0     0  -
adc_koef                              85F4         no  WORD  Internal   ABS     51  private  text         0     0  -
adc_reg_init                          85F6         no  WORD  Internal   ABS     52  private  text         0     0  -

crc_hi                                0060         no  WORD  Internal   ABS     31  private  text         0     0  -
crc_lo                                0061         no  WORD  Internal   ABS     32  private  text         0     0  -
crc_cnt                               0062         no  WORD  Internal   ABS     33  private  text         0     0  -
crc_index                             0063         no  WORD  Internal   ABS     34  private  text         0     0  -

delay_10ms                            85CB         no  WORD  Internal   ABS     61  private  text         0     0  -

end_tx                                849E         no  WORD  Internal   ABS    360  private  text        14     0  -

i2c_ads_read                          8101         no  WORD  Internal   ABS     55  private  text         0     0  -

lock_memory                           85B3         no  WORD  Internal   ABS     59  private  text         0     0  -

mb_address                            85F0         no  WORD  Internal   ABS     49  private  text         0     0  -
mb_input_read                         82D3         no  WORD  Internal   ABS    164  public   text        38     0  -
modbus_input_read_data_copy           82F9         no  WORD  Internal   ABS    180  private  text        19     0  -
modbus_input_read_CRC                 830C         no  WORD  Internal   ABS    189  private  text        11     0  -
mb_holding_read                       8317         no  WORD  Internal   ABS    196  public   text        38     0  -
modbus_holding_read_data_copy         833D         no  WORD  Internal   ABS    212  private  text        19     0  -
modbus_holding_read_CRC               8350         no  WORD  Internal   ABS    221  private  text        11     0  -
mb_holding_write                      835B         no  WORD  Internal   ABS    229  public   text        26     0  -
modbus_holding_write_0                8375         no  WORD  Internal   ABS    242  private  text        15     0  -
modbus_holding_write_1                8384         no  WORD  Internal   ABS    247  private  text        17     0  -
modbus_holding_write_2                8395         no  WORD  Internal   ABS    253  private  text        17     0  -
modbus_holding_write_3                83A6         no  WORD  Internal   ABS    259  private  text        17     0  -
modbus_holding_write_OK               83B7         no  WORD  Internal   ABS    266  private  text        31     0  -
modbus_holding_write_CRC              83D6         no  WORD  Internal   ABS    274  private  text        15     0  -

next                                  848A         no  WORD  Internal   ABS    350  private  text         8     0  -

parse_modbus                          8254         no  WORD  Internal   ABS     87  public   text         8     0  -
parse_test_1                          8254         no  WORD  Internal   ABS     88  private  text         8     0  -
parse_test_2                          825C         no  WORD  Internal   ABS     94  private  text        10     0  -
parse_CRC                             8266         no  WORD  Internal   ABS    100  private  text        11     0  -
parse_test_3                          8271         no  WORD  Internal   ABS    105  private  text         7     0  -
parse_test_4                          8278         no  WORD  Internal   ABS    109  private  text         7     0  -
parse_test_5                          827F         no  WORD  Internal   ABS    113  private  text        15     0  -
parse_modbus_input_read               828E         no  WORD  Internal   ABS    121  private  text        15     0  -
parse_modbus_holding_read             829D         no  WORD  Internal   ABS    131  private  text        15     0  -
parse_modbus_holding_write            82AC         no  WORD  Internal   ABS    141  private  text        11     0  -
parse_modbus_end                      82B7         no  WORD  Internal   ABS    151  private  text        27     0  -
parse_modbus_end_ret                  82D2         no  WORD  Internal   ABS    161  private  text         1     0  -

temp1_w                               0078         no  WORD  Internal   ABS     36  private  text         0     0  -
temp2_w                               007A         no  WORD  Internal   ABS     37  private  text         0     0  -
temp3_w                               007C         no  WORD  Internal   ABS     38  private  text         0     0  -
temp4_w                               007E         no  WORD  Internal   ABS     39  private  text         0     0  -
STMicroelectronics list file postprocessor v1.01   (C)2009-2022   Tue Feb 08 00:03:06 2022
Page 17  Assembler
                                               c:\project\stm8\bit_asm\uart_mb.asm

temp1_b                               0080         no  WORD  Internal   ABS     40  private  text         0     0  -
temp2_b                               0081         no  WORD  Internal   ABS     41  private  text         0     0  -
temp3_b                               0082         no  WORD  Internal   ABS     42  private  text         0     0  -
temp4_b                               0083         no  WORD  Internal   ABS     43  private  text         0     0  -

uartrx_cnt                            0018         no  WORD  Internal   ABS     12  private  text         0     0  -
uarttx_cnt                            0038         no  WORD  Internal   ABS     20  private  text         0     0  -
uartrx_cnt_save                       0058         no  WORD  Internal   ABS     29  private  text         0     0  -
unlock_PROG                           85A1         no  WORD  Internal   ABS     57  private  text         0     0  -
unlock_DATA                           85AA         no  WORD  Internal   ABS     58  private  text         0     0  -
uart_init                             8213         no  WORD  Internal   ABS     64  public   text        65     0  -
uart_mb_write                         847F         no  WORD  Internal   ABS    345  public   text        11     0  -

wait_tx                               8492         no  WORD  Internal   ABS    354  private  text        12     0  -


217 labels
No errors on assembly of 'c:\project\stm8\bit_asm\uart_mb.asm'